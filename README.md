pqombp.github.io
================

This is the repository for Promenadorquestern och med Baletten Paletten's
website. It is generated by [Jekyll](https://jekyllrb.com/) using the base
GitHub Action for Jekyll (i.e., **NOT** the default GitHub pages workflow).

Documentation hints
-------------------

This website has some features that need explanation:
- redirects to other URLs;
- layouts for navigation bars;
- Swedish and English translations of each page;
- a custom Markdown extension.

The first two features use Ruby plugins that Jekyll executes when generating
the website. The last feature is explained
[further below](#custom-markdown-extension-tilde-dot).

**Redirects** are implemented as meta refresh redirects because free GitHub
pages do not allow 301 redirects. The redirects are stored in
[`_data/redirects.csv`](/_data/redirects.csv), and are generated by
[`_plugins/redirect.rb`](/_plugins/redirect.rb). Edit the CSV file to modify
the available redirects.

The **navigation bar** in the header is determined by the file
[`_data/nav.yml`](/_data/nav.yml), and by the layout that each page uses.

**Translations** are implemented as follows. The user writes a file in the
main directory that includes both Swedish and English translations, toggled by
Liquid tags:

```
{%- if page.sv -%}
    Svenskt innehåll här
{%- else -%}
    English content here
{%- endif -%}
```

> [!NOTE]
> The dash (`-`) symbols in the Liquid tags tell Liquid to ignore all
> whitespace outside of the tag. This lets us format the Liquid content
> without affecting the formatting of the generated output.
> 
> If you are having any formatting issues, it might be due to interactions
> between [tilde-dot](#custom-markdown-extension-tilde-dot), Liquid tags, and
> Markdown syntax. Make sure that you are not ignoring important whitespace
> around headings, tilde-dot tags, etc.

The user then adds the following variables to the page's front matter:

* `title`, the Swedish title
* either `en_title` or `en_slug`, the English title and the English slug
  (the part of the URL between the last `/` and `.html`). Including either one
  of these variables will cause the English version of the page to be created.

The plugin [`_plugins/page_translations.rb`](/_plugins/page_translations.rb)
goes through each page and determines if it needs an English translation. Only
the English versions get a subdirectory, `en/`.

> [!NOTE]
> The translation plugin also automatically creates a `slug` variable for the
> Swedish versions of pages. This seems to be a missing feature in Jekyll
> (slugs are defined for posts, but not pages).

Custom Markdown extension ("tilde-dot")
---------------------------------------

In order to have slightly richer webpages, I have implemented a basic Markdown
extension, which I am calling **tilde-dot**. This extension implements some
basic elements of [Bootstrap](https://getbootstrap.com/). Pages are processed
by tilde-dot when they include [`tilde-dot.html`](/_includes/tilde-dot.html).
In practice, the user will call a layout that includes tilde-dot. For example,
on a Markdown page with `layout: main`, the code

```
Title
=====

~.~

~.text.~

Text with dynamic width

~.float.right.~

Float on the right

~.~

Full-width text

```

will produce the following HTML:

```
<div class="row">
    <div class="col-12">
        <h1 id="title">Title</h1>
    </div>
</div>

<div class="row">
    <div class="col-12 col-md-6 col-lg-7 md-first">
        <p>Text with dynamic width</p>
    </div>
    <div class="col-12 col-md-6 col-lg-5 md-last">
        <p>Float on the right</p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <p>Full-width text</p>
    </div>
</div>
```

This is done via Liquid templating: see the layout
[`tilde-dot.html`](/_includes/tilde-dot.html). In words, the code is
translated into Bootstrap rows and columns. The tag `~.~` creates a new row,
and the tags `~.[NAME].~` put all content, up until the next tag, into a
Boostrap column. The full list of available `[NAME]`s can be found in
[`_data/tilde_dot_names.csv`](/_data/tilde_dot_names.csv).

> [!WARNING]
> Due to the hack-y nature of the extension, tilde-dot tags must be separated
> by blank lines on both sides *after* the Liquid templating is processed.
> Essentially, if there were no extra processing, each tag should be
> surrounded by its own `<p>...<\p>`. In particular, make sure that your
> Liquid tags are preserving necessary whitespace!